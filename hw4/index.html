<html>
	<head>
		<script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=default'></script>
		<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
		<style>
			h1 {
				text-align: center;
			}

			.container {
				margin: 0 auto;
				padding: 60px 20%;
			}

			figure {
				text-align: center;
			}

			img {
				display: inline-block;
			}

			body {
				font-family: 'Inter', sans-serif;
			}
		</style>
	</head>
	<body>
		<div class="container">
		<h1>CS184/284A Spring 2025 Homework 4 Write-Up</h1>
		<div style="text-align: center;">Names: </div>

		<br>

		Link to webpage: (TODO) <a href="https://cs184.eecs.berkeley.edu/sp25">cs184.eecs.berkeley.edu/sp25</a>

		<br>

		Link to GitHub repository: (TODO) <a href="https://cs184.eecs.berkeley.edu/sp25">cs184.eecs.berkeley.edu/sp25</a>

		<figure>
			<img src="clothsim.png" alt="Cloth draped over sphere" style="width:70%"/>
			<figcaption>You can add images with captions!</figcaption>
		</figure>

		<!--
		We've already added one heading per part, to make your write-up as navigable when grading. Please fit your write-up within these sections!
		-->

		<h2>Overview</h2>
		Give a high-level overview of what you implemented in this homework. Think about what you've built as a whole. Share your thoughts on what interesting things you've learned from completing the homework.

		<h2>Part 1: Masses and springs</h2>
		<p>Here are a couple views of our cloth:</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="./pt1/clothsim-1.1.png" width="400px" />
			  <figcaption>View 1</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt1/clothsim-1.2.png" width="400px" />
			  <figcaption>View 2</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt1/clothsim-1.3.png" width="400px" />
			  <figcaption>View 3</figcaption>
			</div>
		</div>
		<p>And here is a view with different types of springs enabled:</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="./pt1/clothsim-1-no-shearing.png" width="400px" />
			  <figcaption>No Shearing Springs</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt1/clothsim-1-only-shearing.png" width="400px" />
			  <figcaption>Only Shearing Springs</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt1/clothsim-1-all.png" width="400px" />
			  <figcaption>All Spring Types</figcaption>
			</div>
		  </div>
		  

		  
		<h2>Part 2: Simulation via numerical integration</h2>
		<p>We took some screenshots of the simulation after it had reached "equilibrium", or when the cloth stopped moving much.</p>
		<p>Here, we changed the values of k = [500, 5000, 50000] with density = 15 as a constant.</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-2-k=500.png" width="400px" />
			  <figcaption>k=500</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-2-k=5000.png" width="400px" />
			  <figcaption>k=5000</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-2-k=50000.png" width="400px" />
			  <figcaption>k=50000</figcaption>
			</div>
			
		</div>
		<p>As k increases, we can see the cloth look more and more just the flat cloth grid unaffected by external forces in Part 1. This is because when k increases the force of the springs starts to outweigh the forces from the external forces on each point mass, causing the cloth to look more and more uniform.</p>
		<br/>
		<p>Here, we changed values of d = [1, 10, 100, 1000] while keeping k = 5000 constant.</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-2-d=1.png" width="400px" />
			  <figcaption>d=1</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-2-d=10.png" width="400px" />
			  <figcaption>d=10</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-2-d=100.png" width="400px" />
			  <figcaption>d=100</figcaption>
			</div>
			<div style="text-align: center;">
				<img src="./pt2/clothsim-2-d=1000.png" width="400px" />
				<figcaption>d=1000</figcaption>
			  </div>
		</div>
		<p>As density increases, we can see the cloth start to sag more and more. This is due to the point masses weighing a lot more now - and when density = 1000, you can see a triangle start to form as the cloth starts to really weigh down on the 2 pinned point masses.</p>
		<br/>
		<p>Here, we set k = 5000 and d = 15, while changing damping between [0, 1.00%]. To see the effects of damping, we no longer wait till the cloth achieves "equilibrium", and instead take a picture after 2 seconds of the simulation have passed.</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-2-damp=0.png" width="400px" />
			  <figcaption>damp=0%</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-2-damp=25.png" width="400px" />
			  <figcaption>damp=0.25%</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-2-damp=50.png" width="400px" />
			  <figcaption>damp=0.50%</figcaption>
			</div>
			<div style="text-align: center;">
				<img src="./pt2/clothsim-2-dampp=75.png" width="400px" />
				<figcaption>damp=0.75%</figcaption>
			  </div>
			  <div style="text-align: center;">
				<img src="./pt2/clothsim-2-damp=100.png" width="400px" />
				<figcaption>d=1.00%</figcaption>
			  </div>
		</div>
		<p>It is a little difficult to tell here, but increasing dampening makes the cloth fall at a quicker speed, and it falls at a uniform pace as well. This makes sense - when dampening = 0, we have no energy lost to friction or heat, so we don't expect any of the force to decrease as the cloth falls. When dampening increases, the cloth loses more and more energy to heat and friction, thus our cloth falls a lot more slowly and it decelerates much faster too.</p>

		<h2>Part 3: Handling collisions with other objects</h2>
		<p>We pretty much followed the task description verbatim to accomplish plane and sphere collision. For spheres, we first checked if our new point mass position was in the sphere or not. This was simple, since all we needed to do was check if its position’s distance from the sphere’s origin was smaller than the sphere’s radius or not. If it was not in the sphere, the point did not collide, and we returned from the function early.
			To adjust its position of a colliding point mass, we first calculated the tangent point of the line from origin to position with the sphere’s surface with the following equation:
		</p>
		<p>
			tangent_point = origin + (radius * (position - origin).unit())
		</p>
		<p>
			This tangent_point is not (necessarily) on the line from the point mass’s old position to the current/new position. As such, we explicitly calculate the vector from the old position to the tangent point, and scale down this vector by (1-friction) to find a point somewhere between the old position and the collision point, where the new position can go. This is the final position that we set for the our point mass.
		</p>
		<p>
			As for plane collision, the general steps are the same, but with different algorithms to achieve them. First, to check if the point mass intersects the plane, we use dot product. We take the vector between the point on the plane and each of the point mass’s old and new positions. With each of these vectors, we compute its dot product with the plane’s normal vector. The sign of these dot products tells us which side of the plane the old and new positions are on. If they are on opposite sides (so they have opposite signs), that means that the point mass intersects the plane, and we need to find the point of collision.
		</p>
		<p>
			To compute the tangent point / point of collision, we use the ray-plane intersection method from class, with the ray’s position, and an arbitrary point on the plane. However, we also offset this tangent point by a SURFACE_OFFSET in the direction of the normal vector, in order to make sure that the new position of the point mass is on the top side of the plane, not the bottom side. Using this off-setted tangent point, we follow the algorithm the same way we did with a sphere, to compute the point mass’s final, non-collided position.
		</p>
		<p>
			Throughout both collision algorithms, we take care to make sure vector directions align and give us our intended result.
		</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="sphere-500.png" width="400px" />
			  <figcaption>k=500</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="sphere-5000.png" width="400px" />
			  <figcaption>k=5000</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="sphere-50000.png" width="400px" />
			  <figcaption>k=50000</figcaption>
			</div>
		</div>
		<p>
			The main difference here is that as ks increases, the "stiffness" of the cloth increases. At k = 500, we can see the cloth draped on the sphere has lots of surface area where the cloth is directly contacting the sphere - this is because the force of gravity is stronger than the internal forces of the springs. As k increases, we can see in the picture where k = 50000 that much less of the cloth is actually contacting the sphere. This is because the high force incurred by the springs is making the cloth more stiff, and thus it doesn't drape over the sphere as much.
		</p>
		<br/>
		<p>And cloth collision with a plane:</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="plane-collide-color.png" width="400px" />
			  <figcaption>Plane collision with a cloth</figcaption>
			</div>
		</div>
		

		<h2>Part 4: Handling self-collisions</h2>
		<p>
			Our implementation follows the task description very closely.
		</p>
		<p>
			For hash_position(), We use the given equations of w, h, and t to define our 3D boxes. However, instead of using fmod to find which box a point mass belongs in, we simply divide its x, y, z coordinates by w, h, t respectively and floor the result. Then, with these 3D box indices (wi, hi, and ti) we use the classic nested array index to 1D array index translation to get a unique box ID:
		</p>
		<p>
			int unique_ID = wi + hi * width + ti * width * height
		</p>
		<p>
			The final hash / unique box ID is this integer casted to a float.
		</p>
		<p>
			For build_spatial_map(), the implementation follows the task description to a tee, just also making sure to instantiate a hash key if it does not already exist in the map, with a new vector of point masses allocated in the heap, not the function’s stack.
		</p>
		<p>
			For self_collide(), the algorithm again follows the task description very directly. Candidates are other point massesdist) / dist box as the given point mass, retrieved from our map. To get the final correction_vector, we initialize it to the zero vector in 3D, and a count of collided point masses to 0 before we iterate through all candidates. On each iteration, we first check and continue to the next iteration if the candidate is the given point mass itself by address. If we detect a collision with the given threshold (2 * thickness), the correction vector is determined by the following equation:
		</p>
		<p>
			correction_vector = (threshold - dist) / dist * (position - candidate_position)
		</p>
		<p>
			This essentially takes the vector from the candidate to the position, and multiplies it by the ratio of the difference between the threshold distance and the actual distance over the actual distance. This essentially is the vector that our point mass needs to be shifted by, in order to be a valid distance away from the candidate point mass.
		</p>	
		<p>
			After the iteration, we divide the sum of all collided correction vectors over the number of collisions to take their average, as intended. Then, we divide again by simulation_steps, for the reason stated in the task description. This final, averaged and scaled collision vector is added to our point mass’s position.
		</p>
		<p>
			Bringing these 3 functions all together, in simulate() for one time step, we first populate our mapping of boxes to point masses contained in the box by calling build_spatial_map(), which calls hash_position() on each point mass. Then, back in simulate(), we iterate through all point masses in the cloth, and call self_collide() on each, using this map to compute collisions with the cloth itself and adjust each point mass accordingly.
		</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="4-1.png" width="400px" />
			  <figcaption>Early stage Self-Collision</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="4-4.png" width="400px" />
			  <figcaption>Mid stage Self-Collision</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="4-7.png" width="400px" />
			  <figcaption>Late stage Self-Collision</figcaption>
			</div>
		</div>
		<p>As density increases, the amount of folds on the cloth increases. When the cloth is heavier, you expect the force of gravity to outweigh the stiffness of the cloth stored by its spring forces, which is why there are so many folds. At a lower density, the spring forces hold up more against gravity, causing less folds to occur.</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-4-d=1.png" width="400px" />
			  <figcaption>density=1</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-4-d=1000.png" width="400px" />
			  <figcaption>density=1000</figcaption>
			</div>
		</div>
		<p>As ks increases, the amount of folds on the cloth decreases. This makes sense - as outlined earlier, higher k values make the cloth more stiff and resistant to folding from the forces of gravity, so less folds as ks increases makes sense.</p>
		<div style="display: flex; justify-content: space-evenly; align-items: center; flex-wrap: wrap; gap: 20px; padding: 20px;">
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-4-k=5.png" width="400px" />
			  <figcaption>k=5</figcaption>
			</div>
			<div style="text-align: center;">
			  <img src="./pt2/clothsim-4-k=50000.png" width="400px" />
			  <figcaption>ks=50000</figcaption>
			</div>
		</div>

		<h2>Part 5: Shaders</h2>
		Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

		<h2>(Optional) Part 6: Extra Credit - Additional cloth simulation features!</h2>
		Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
		
		<h2>Additional Notes (please remove)</h2>
		<ul>
			<li>You can also add code if you'd like as so: <code>code code code</code></li>
			<li>If you'd like to add math equations, 
				<ul>
					<li>You can write inline equations like so: \( a^2 + b^2 = c^2 \)</li>
					<li>You can write display equations like so: \[ a^2 + b^2 = c^2 \]</li>
				</ul>
			</li>
		</ul>
		</div>
	</body>
</html>